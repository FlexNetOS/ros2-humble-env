{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aria.tools/mcp/schemas/dependency-resolver",
  "title": "Dependency Resolver Tool",
  "description": "MCP tool for resolving dependencies across ARIA's multi-platform stack, detecting conflicts, and proposing solutions",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "const": "dependency_resolver",
      "description": "Tool identifier"
    },
    "description": {
      "type": "string",
      "const": "Analyzes dependency graphs, detects version conflicts, resolves circular dependencies, and proposes installation order"
    },
    "inputSchema": {
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["analyze", "detect_conflicts", "resolve", "generate_install_order", "validate"],
          "description": "Dependency resolution action"
        },
        "scope": {
          "type": "object",
          "properties": {
            "domains": {"type": "array", "items": {"type": "string"}},
            "components": {"type": "array", "items": {"type": "string"}},
            "include_transitive": {"type": "boolean", "default": true}
          },
          "description": "Scope of dependency analysis"
        },
        "platforms": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["nix", "pixi", "docker", "cargo", "npm", "pip", "system"]
          },
          "default": ["all"],
          "description": "Platforms to analyze dependencies for"
        },
        "resolution_strategy": {
          "type": "string",
          "enum": ["conservative", "balanced", "aggressive", "latest"],
          "default": "balanced",
          "description": "Strategy for resolving version conflicts"
        },
        "constraints": {
          "type": "object",
          "properties": {
            "min_versions": {"type": "object"},
            "max_versions": {"type": "object"},
            "pinned_versions": {"type": "object"},
            "excluded_versions": {"type": "object"}
          },
          "description": "Version constraints for dependency resolution"
        }
      },
      "required": ["action"]
    },
    "outputSchema": {
      "type": "object",
      "properties": {
        "action": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"},
        "dependency_graph": {
          "type": "object",
          "properties": {
            "nodes": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {"type": "string"},
                  "name": {"type": "string"},
                  "version": {"type": "string"},
                  "platform": {"type": "string"},
                  "domain": {"type": "string"},
                  "type": {"type": "string", "enum": ["direct", "transitive", "dev", "optional"]},
                  "installed": {"type": "boolean"}
                }
              }
            },
            "edges": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "from": {"type": "string"},
                  "to": {"type": "string"},
                  "version_constraint": {"type": "string"},
                  "type": {"type": "string", "enum": ["requires", "recommends", "conflicts_with"]}
                }
              }
            },
            "statistics": {
              "type": "object",
              "properties": {
                "total_dependencies": {"type": "number"},
                "direct": {"type": "number"},
                "transitive": {"type": "number"},
                "optional": {"type": "number"},
                "depth": {"type": "number"}
              }
            }
          }
        },
        "conflicts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "package": {"type": "string"},
              "platform": {"type": "string"},
              "conflict_type": {"type": "string", "enum": ["version_mismatch", "incompatible", "circular", "missing"]},
              "severity": {"type": "string", "enum": ["critical", "major", "minor"]},
              "requirements": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "requester": {"type": "string"},
                    "version": {"type": "string"},
                    "constraint": {"type": "string"}
                  }
                }
              },
              "resolution_options": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "strategy": {"type": "string"},
                    "version": {"type": "string"},
                    "impact": {"type": "string"},
                    "breaking_changes": {"type": "boolean"}
                  }
                }
              }
            }
          }
        },
        "circular_dependencies": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "cycle": {"type": "array", "items": {"type": "string"}},
              "severity": {"type": "string", "enum": ["critical", "warning"]},
              "resolution": {"type": "string"}
            }
          }
        },
        "missing_dependencies": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "required_by": {"type": "array", "items": {"type": "string"}},
              "version_constraint": {"type": "string"},
              "available_versions": {"type": "array", "items": {"type": "string"}},
              "recommended_version": {"type": "string"},
              "installation_method": {"type": "string"}
            }
          }
        },
        "resolved_dependencies": {
          "type": "object",
          "properties": {
            "nix": {"type": "object"},
            "pixi": {"type": "object"},
            "docker": {"type": "object"},
            "cargo": {"type": "object"},
            "npm": {"type": "object"},
            "pip": {"type": "object"}
          },
          "description": "Resolved dependency versions by platform"
        },
        "installation_order": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "step": {"type": "number"},
              "platform": {"type": "string"},
              "packages": {"type": "array", "items": {"type": "string"}},
              "command": {"type": "string"},
              "parallel_safe": {"type": "boolean"},
              "estimated_time_seconds": {"type": "number"}
            }
          },
          "description": "Ordered steps for dependency installation"
        },
        "validation_results": {
          "type": "object",
          "properties": {
            "all_conflicts_resolved": {"type": "boolean"},
            "no_circular_deps": {"type": "boolean"},
            "all_constraints_satisfied": {"type": "boolean"},
            "security_check": {
              "type": "object",
              "properties": {
                "vulnerabilities_found": {"type": "number"},
                "critical": {"type": "number"},
                "high": {"type": "number"},
                "medium": {"type": "number"},
                "low": {"type": "number"}
              }
            }
          }
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "priority": {"type": "string", "enum": ["P0", "P1", "P2", "P3"]},
              "type": {"type": "string", "enum": ["upgrade", "downgrade", "alternative", "feature_flag"]},
              "description": {"type": "string"},
              "packages": {"type": "array", "items": {"type": "string"}},
              "action": {"type": "string"}
            }
          }
        }
      },
      "required": ["action", "timestamp"]
    }
  },
  "required": ["name", "description", "inputSchema", "outputSchema"]
}
