{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aria.tools/mcp/schemas/configuration-manager",
  "title": "Configuration Manager Tool",
  "description": "MCP tool for managing configuration files across ARIA's multi-platform stack (Nix, Pixi, Docker, Cargo)",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "const": "configuration_manager",
      "description": "Tool identifier"
    },
    "description": {
      "type": "string",
      "const": "Manages configuration files, validates syntax, detects drift, and proposes configuration updates"
    },
    "inputSchema": {
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["validate", "detect_drift", "propose_update", "apply_update", "rollback"],
          "description": "Configuration management action to perform"
        },
        "config_files": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "path": {"type": "string", "description": "Absolute path to configuration file"},
              "type": {
                "type": "string",
                "enum": ["flake.nix", "pixi.toml", "docker-compose", "cargo.toml", "package.json", "yaml", "json"],
                "description": "Configuration file type"
              }
            }
          },
          "description": "Configuration files to manage"
        },
        "validation_rules": {
          "type": "object",
          "properties": {
            "syntax": {"type": "boolean", "default": true},
            "schema": {"type": "boolean", "default": true},
            "dependencies": {"type": "boolean", "default": true},
            "security": {"type": "boolean", "default": true}
          },
          "description": "Validation rules to apply"
        },
        "update_spec": {
          "type": "object",
          "properties": {
            "component": {"type": "string"},
            "version": {"type": "string"},
            "dependencies": {"type": "array", "items": {"type": "string"}},
            "configuration": {"type": "object"},
            "target_file": {"type": "string"}
          },
          "description": "Specification for configuration update (used with propose_update/apply_update)"
        }
      },
      "required": ["action"]
    },
    "outputSchema": {
      "type": "object",
      "properties": {
        "action": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"},
        "results": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file": {"type": "string"},
              "status": {"type": "string", "enum": ["success", "warning", "error", "unchanged"]},
              "validation_results": {
                "type": "object",
                "properties": {
                  "syntax_valid": {"type": "boolean"},
                  "schema_valid": {"type": "boolean"},
                  "dependencies_resolved": {"type": "boolean"},
                  "security_issues": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "severity": {"type": "string", "enum": ["critical", "high", "medium", "low"]},
                        "description": {"type": "string"},
                        "line": {"type": "number"},
                        "remediation": {"type": "string"}
                      }
                    }
                  }
                }
              },
              "drift_detected": {
                "type": "object",
                "properties": {
                  "has_drift": {"type": "boolean"},
                  "differences": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "path": {"type": "string"},
                        "expected": {"type": "string"},
                        "actual": {"type": "string"},
                        "severity": {"type": "string", "enum": ["critical", "major", "minor"]}
                      }
                    }
                  }
                }
              },
              "proposed_changes": {
                "type": "object",
                "properties": {
                  "additions": {"type": "array", "items": {"type": "string"}},
                  "modifications": {"type": "array", "items": {"type": "string"}},
                  "deletions": {"type": "array", "items": {"type": "string"}},
                  "diff": {"type": "string", "description": "Unified diff format"}
                }
              },
              "applied_changes": {
                "type": "object",
                "properties": {
                  "success": {"type": "boolean"},
                  "backup_path": {"type": "string"},
                  "changes_applied": {"type": "number"},
                  "verification_status": {"type": "string", "enum": ["verified", "pending", "failed"]}
                }
              },
              "errors": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "code": {"type": "string"},
                    "message": {"type": "string"},
                    "line": {"type": "number"},
                    "column": {"type": "number"}
                  }
                }
              },
              "warnings": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "code": {"type": "string"},
                    "message": {"type": "string"},
                    "suggestion": {"type": "string"}
                  }
                }
              }
            }
          }
        },
        "summary": {
          "type": "object",
          "properties": {
            "total_files": {"type": "number"},
            "successful": {"type": "number"},
            "warnings": {"type": "number"},
            "errors": {"type": "number"},
            "drift_count": {"type": "number"},
            "updates_proposed": {"type": "number"},
            "updates_applied": {"type": "number"}
          }
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {"type": "string", "enum": ["security", "optimization", "maintenance", "compatibility"]},
              "priority": {"type": "string", "enum": ["P0", "P1", "P2", "P3"]},
              "description": {"type": "string"},
              "affected_files": {"type": "array", "items": {"type": "string"}},
              "action": {"type": "string"}
            }
          }
        }
      },
      "required": ["action", "timestamp", "results", "summary"]
    }
  },
  "required": ["name", "description", "inputSchema", "outputSchema"]
}
