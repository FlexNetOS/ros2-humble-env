{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aria.tools/mcp/schemas/feature-flag-manager",
  "title": "Feature Flag Manager Tool",
  "description": "MCP tool for managing A/B feature flags to resolve component conflicts in ARIA",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "const": "feature_flag_manager",
      "description": "Tool identifier"
    },
    "description": {
      "type": "string",
      "const": "Manages feature flags for conflicting components, enabling A/B configuration switching without omitting features"
    },
    "inputSchema": {
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "enum": ["create", "list", "update", "delete", "switch", "validate"],
          "description": "Feature flag management action"
        },
        "flag_definition": {
          "type": "object",
          "properties": {
            "flag_name": {
              "type": "string",
              "pattern": "^[a-z][a-z0-9-]*$",
              "description": "Feature flag name (kebab-case)"
            },
            "description": {"type": "string"},
            "conflict_area": {
              "type": "string",
              "description": "Area of conflict (e.g., 'vector-db', 'inference-engine', 'state-storage')"
            },
            "options": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "option_name": {"type": "string"},
                  "component": {"type": "string"},
                  "version": {"type": "string"},
                  "dependencies": {"type": "array", "items": {"type": "string"}},
                  "configuration": {"type": "object"},
                  "pros": {"type": "array", "items": {"type": "string"}},
                  "cons": {"type": "array", "items": {"type": "string"}}
                },
                "required": ["option_name", "component"]
              },
              "minItems": 2,
              "description": "Available options for the feature flag"
            },
            "default_option": {
              "type": "string",
              "description": "Default option (must match one of the option_name values)"
            },
            "config_locations": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "file": {"type": "string"},
                  "format": {"type": "string", "enum": ["toml", "yaml", "json", "nix"]},
                  "section": {"type": "string"}
                }
              },
              "description": "Configuration files affected by this flag"
            },
            "affected_domains": {
              "type": "array",
              "items": {"type": "string"},
              "description": "ARIA domains affected by this flag"
            },
            "switching_instructions": {
              "type": "string",
              "description": "Instructions for switching between options"
            }
          },
          "required": ["flag_name", "conflict_area", "options", "default_option"]
        },
        "switch_spec": {
          "type": "object",
          "properties": {
            "flag_name": {"type": "string"},
            "target_option": {"type": "string"},
            "apply_changes": {"type": "boolean", "default": false},
            "backup_configs": {"type": "boolean", "default": true}
          },
          "description": "Specification for switching feature flag (used with 'switch' action)"
        }
      },
      "required": ["action"]
    },
    "outputSchema": {
      "type": "object",
      "properties": {
        "action": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"},
        "result": {
          "type": "object",
          "properties": {
            "status": {"type": "string", "enum": ["success", "partial", "failed"]},
            "message": {"type": "string"}
          }
        },
        "flags": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "flag_name": {"type": "string"},
              "description": {"type": "string"},
              "conflict_area": {"type": "string"},
              "current_option": {"type": "string"},
              "available_options": {"type": "array", "items": {"type": "string"}},
              "default_option": {"type": "string"},
              "affected_domains": {"type": "array", "items": {"type": "string"}},
              "config_locations": {"type": "array", "items": {"type": "string"}},
              "last_modified": {"type": "string", "format": "date-time"},
              "validation_status": {"type": "string", "enum": ["valid", "invalid", "warning"]},
              "usage_stats": {
                "type": "object",
                "properties": {
                  "switches": {"type": "number"},
                  "last_switch": {"type": "string", "format": "date-time"}
                }
              }
            }
          }
        },
        "switch_result": {
          "type": "object",
          "properties": {
            "flag_name": {"type": "string"},
            "from_option": {"type": "string"},
            "to_option": {"type": "string"},
            "changes_applied": {"type": "boolean"},
            "affected_files": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "file": {"type": "string"},
                  "backup_path": {"type": "string"},
                  "changes": {"type": "array", "items": {"type": "string"}},
                  "status": {"type": "string", "enum": ["updated", "unchanged", "error"]}
                }
              }
            },
            "verification": {
              "type": "object",
              "properties": {
                "config_valid": {"type": "boolean"},
                "dependencies_resolved": {"type": "boolean"},
                "services_restarted": {"type": "array", "items": {"type": "string"}},
                "health_checks": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "service": {"type": "string"},
                      "status": {"type": "string", "enum": ["healthy", "unhealthy", "unknown"]}
                    }
                  }
                }
              }
            },
            "rollback_available": {"type": "boolean"},
            "rollback_command": {"type": "string"}
          }
        },
        "validation_results": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "flag_name": {"type": "string"},
              "valid": {"type": "boolean"},
              "issues": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "severity": {"type": "string", "enum": ["error", "warning", "info"]},
                    "message": {"type": "string"},
                    "suggestion": {"type": "string"}
                  }
                }
              }
            }
          }
        },
        "conflict_matrix": {
          "type": "object",
          "properties": {
            "total_conflicts": {"type": "number"},
            "resolved": {"type": "number"},
            "unresolved": {"type": "number"},
            "conflicts": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "area": {"type": "string"},
                  "components": {"type": "array", "items": {"type": "string"}},
                  "flag_exists": {"type": "boolean"},
                  "flag_name": {"type": "string"},
                  "resolution_status": {"type": "string", "enum": ["resolved", "pending", "manual_required"]}
                }
              }
            }
          }
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {"type": "string", "enum": ["new_flag", "flag_update", "conflict_resolution", "optimization"]},
              "priority": {"type": "string", "enum": ["P0", "P1", "P2", "P3"]},
              "description": {"type": "string"},
              "action": {"type": "string"}
            }
          }
        }
      },
      "required": ["action", "timestamp", "result"]
    }
  },
  "required": ["name", "description", "inputSchema", "outputSchema"]
}
