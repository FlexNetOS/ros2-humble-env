# Refact AI Self-Hosting (BUILDKIT_STARTER_SPEC.md Layer 7 - Agent Runtime)
# Self-hostable coding agent for software development
# Repository: https://github.com/smallcloudai/refact

services:
  refact:
    image: smallcloud/refact_self_hosting:nightly
    container_name: refact
    ports:
      - "8008:8008"    # Web UI and API
    environment:
      # Model configuration
      - REFACT_PERM_DIR=/perm_storage
      # GPU settings (uncomment for NVIDIA GPU)
      # - CUDA_VISIBLE_DEVICES=0
    volumes:
      - ./data/refact/perm_storage:/perm_storage:cached
      - ./data/refact/workdir:/workdir:cached
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8008/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - agentic-network

  # Optional: Refact with GPU support (uncomment if NVIDIA GPU available)
  # refact-gpu:
  #   image: smallcloud/refact_self_hosting:nightly
  #   container_name: refact-gpu
  #   ports:
  #     - "8009:8008"
  #   environment:
  #     - REFACT_PERM_DIR=/perm_storage
  #     - CUDA_VISIBLE_DEVICES=0
  #   volumes:
  #     - ./data/refact/perm_storage:/perm_storage:cached
  #     - ./data/refact/workdir:/workdir:cached
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: 1
  #             capabilities: [gpu]
  #   restart: unless-stopped
  #   networks:
  #     - agentic-network

networks:
  agentic-network:
    external: true
    name: agentic-network

# Usage:
# 1. Create data directories:
#    mkdir -p data/refact/perm_storage data/refact/workdir
#
# 2. Create network (if not exists):
#    docker network create agentic-network
#
# 3. Start Refact:
#    docker-compose -f docker-compose.refact.yml up -d
#
# 4. Access Web UI:
#    http://localhost:8008
#
# 5. Download models via Web UI:
#    Navigate to Settings -> Models and download desired models
#
# 6. Configure IDE integration:
#    - VSCode: Install "Refact.ai" extension
#    - JetBrains: Install "Refact.ai" plugin
#    - Point to http://localhost:8008 as the server address
#
# Features:
# - Code completion (AI-powered autocomplete)
# - Chat interface for code questions
# - Code refactoring suggestions
# - Multiple model support (local and cloud)
# - Privacy-first: all processing can be local
#
# Documentation: https://github.com/smallcloudai/refact
